<!DOCTYPE html>
<HTML>
<head>
    <meta charset="utf-8">
    <title>CS:GO Inventory Rater!</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Counter Strike : Global Offensive <br> Inventory Rater</h1>
    
    <!-- This Div should be hidden after calculating -->
    <div id="input_field" class="boxed">
        <div id="box_w_expla">
            <input id="steam_id" type="text" placeholder="Steam-ID">
            <span>To find your Steam-ID: go to "account details" in the application and look at the top left of the window, make sure to set your inventory to public</span>
        </div>
        <input id="id_submit" type="submit" value="Get Inventory" onclick="insert_link()">
        <!--this button calls the insert_link() function where the contents of the ID field will be collected and insterted into the link structure. The JS will then redirect the user to a NEW TAB IN THE BROWSER with the json-->
        
         <script>
            function insert_link() {
            let id = document.getElementById("steam_id").value;
            window.open("https://steamcommunity.com/profiles/"+id+"/inventory/json/730/2", "_blank");
            }
        </script>
        
        <p>After clicking this button, right click the new page and hit 'save as'.<br>Save the File as a JSON and submit it below:</p>
        
        <input type="file" id="inventory_json" accept=".json" name="inventory">
        
        <input type="submit" id="calculate_score" value="Calculate!" onclick="parse_json()">
        <!-- This function takes the file in the previous field, parses it, then runs point calculations. at the end of this process.
            all of the HTML elements marked for revealing will be revealed, this entire DIV 'id = input field' will be hidden, and the elements whose content needs to be populated will be populated-->
        <script>
            //initialize a file reader then call the function associated with it (calculate()) when it is done loading. This is called being asynchronus
            function parse_json(){
                let reader = new FileReader();
                
                reader.onload = calculate;
                
                reader.readAsText(document.getElementById("inventory_json").files[0]);
            }
            
            //this function gets called when reader is done loading since it is an asynchronus method. this is where all of the calculations will be done using the newly created 'Inventory' Object
            function calculate (event){
                str = event.target.result;
                Inventory = JSON.parse(str);
                console.log(Inventory);
                
                //NICK CODE GO HERE, BELOW IS EXAMPLE OF SETTING SCORE AND INSERTING IT INTO THE TEXT THAT THE SHARE BUTTON WILL POSTa
                //Inventory.rgDescriptions["2316436747_188530139"].(subclasses);
              //Inventory.rgDescriptions[items[#]].(subclasses);
                var items = Object.keys(Inventory.rgDescriptions)
                score = 0
               for(let n =0; n<items.length; n++){
                if(Inventory.rgDescriptions[items[n]].tags[0].name == "Graffiti"){
                    switch(Inventory.rgDescriptions[items[n]].tags[2].name){
                        case "Exotic":{
                            score += 10;
                            break;
                        }
                        case "Remarkable":{
                            score += 6;
                            break;
                        }
                        case "High Grade":{
                            score +=2;
                            break;
                        }
                        case "Base Grade":{
                            score +=1;
                            break;
                        }
                        default: break;
                    }
                }
               
            }
            let Skins = [];
    for(let n = 0; n<items.length; n++){
        if(Inventory.rgDescriptions[items[n]].tags.length==6){
            Skins.push(items[n]);
        }
    }
    for(let n = 0; n<Skins.length; n++){
         switch(Inventory.rgDescriptions[Skins[n]].tags[4].name){
            case "Extraordinary":{
                score +=1000;
                break;
            }
            case "Contraband": {
                score +=500;
                break;
            }
            case "Covert":{
                score += 100;
                break;
            }
            case "Classified":{
                score += 50;
                break;
            }
            case "Restricted":{
                score += 25;
                break;
            }
            case "Mil-Spec":{
                score += 10;
                break;
            }
            case "Industrial Grade":{
                score += 5;
                break;
            }
            case "Consumer Grade":{
                score +=1;
                break;
            }
        }
                    switch(Inventory.rgDescriptions[Skins[n]].tags[5].name)
                    {
                    case "Factory New":{
                        score +=10;
                        break;
                    }
                    case "Minimal Wear":{
                        score += 8;
                        break;
                    }
                    case "Field-Tested":{
                        score +=6;
                        break;
                    }
                    case "Well-Worn":{
                        score += 4;
                        break;
                    }
                    case "Battle-Scarred":{
                        score +=2;
                        break;
                    }
                    default:
                        score +=1;
                        break;
                    }
    }
                
                    document.getElementById("score").innerHTML = score;
                
               
                share_string = "My%20CS%3AGO%20inventory%20has%20a%20score%20of%20" + score + ".%20Compare%20yours%20at%20the%20link!"
                
                //https://twitter.com/intent/tweet/?text=My%20CS%3AGO%20inventory%20has%20a%20score%20of%20999.%20Compare%20yours%20at%20the%20link!&amp;url=https%3A%2F%2Fwww.csgoinventoryrater.com%2F
                document.getElementById("twitter_a").href = "https://twitter.com/intent/tweet/?text=" + share_string + "&amp;url=https%3A%2F%2Fwww.csgoinventoryrater.com%2F";
                console.log("twitter url: ",document.getElementById("twitter_a").href);
                //http://www.reddit.com/submit?url=https://www.csgoinventoryrater.com/&title=Post%20to%20Reddit%20via%20URL
                document.getElementById("reddit_a").href = "http://www.reddit.com/submit?url=https://www.csgoinventoryrater.com/&title=" + share_string;
                console.log("reddid url: ", document.getElementById("reddit_a").href);
            }
            
        </script>
    </div>
    
    <!-- this div will be hidden and needs to be revealed with JS -->
    <div id=score_display>
        <p>Your Inventory Score Is:</p>
        <h2 id="score"></h2>
    </div>
    
    <div id="list_of_skins" class="boxed">
        <h3>Your Top Skins:</h3>
        <!-- This list needs to be populated by JS and by default this div is invisible until it is populated, so JS has to be made to reveal it -->
        <ol id="top_skins_list">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ol>
    </div>
    
    <!-- contents within 'div id = share' from https://sharingbuttons.io/ The MIT License (MIT) Copyright (c) 2015 Maximilian Stoiber -->
    <div id="share">
        <!-- Share button Twitter -->
        <a class="resp-sharing-button__link" id="twitter_a" href="https://twitter.com/intent/tweet/?text=&amp;url=https%3A%2F%2Fwww.csgoinventoryrater.com%2F" target="_blank" rel="noopener" aria-label="Share on Twitter">
          <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solidcircle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0C5.38 0 0 5.38 0 12s5.38 12 12 12 12-5.38 12-12S18.62 0 12 0zm5.26 9.38v.34c0 3.48-2.64 7.5-7.48 7.5-1.48 0-2.87-.44-4.03-1.2 1.37.17 2.77-.2 3.9-1.08-1.16-.02-2.13-.78-2.46-1.83.38.1.8.07 1.17-.03-1.2-.24-2.1-1.3-2.1-2.58v-.05c.35.2.75.32 1.18.33-.7-.47-1.17-1.28-1.17-2.2 0-.47.13-.92.36-1.3C7.94 8.85 9.88 9.9 12.06 10c-.04-.2-.06-.4-.06-.6 0-1.46 1.18-2.63 2.63-2.63.76 0 1.44.3 1.92.82.6-.12 1.95-.27 1.95-.27-.35.53-.72 1.66-1.24 2.04z"/></svg>
            </div>Share on Twitter</div>
        </a>

        <!-- Share button Reddit -->
        <a class="resp-sharing-button__link" id="reddit_a" href="https://reddit.com/submit/?url=https%3A%2F%2Fwww.csgoinventoryrater.com%2F&amp;resubmit=true&amp;title=" target="_blank" rel="noopener" aria-label="Share on Reddit">
          <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solidcircle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="9.391" cy="13.392" r=".978"/><path d="M14.057 15.814c-1.14.66-2.987.655-4.122-.004-.238-.138-.545-.058-.684.182-.13.24-.05.545.19.685.72.417 1.63.646 2.568.646.93 0 1.84-.228 2.558-.642.24-.13.32-.44.185-.68-.14-.24-.445-.32-.683-.18zM5 12.086c0 .41.23.78.568.978.27-.662.735-1.264 1.353-1.774-.2-.207-.48-.334-.79-.334-.62 0-1.13.507-1.13 1.13z"/><path d="M12 0C5.383 0 0 5.383 0 12s5.383 12 12 12 12-5.383 12-12S18.617 0 12 0zm6.673 14.055c.01.104.022.208.022.314 0 2.61-3.004 4.73-6.695 4.73s-6.695-2.126-6.695-4.74c0-.105.013-.21.022-.313C4.537 13.73 4 12.97 4 12.08c0-1.173.956-2.13 2.13-2.13.63 0 1.218.29 1.618.757 1.04-.607 2.345-.99 3.77-1.063.057-.803.308-2.33 1.388-2.95.633-.366 1.417-.323 2.322.085.302-.81 1.076-1.397 1.99-1.397 1.174 0 2.13.96 2.13 2.13 0 1.177-.956 2.133-2.13 2.133-1.065 0-1.942-.79-2.098-1.81-.734-.4-1.315-.506-1.716-.276-.6.346-.818 1.395-.88 2.087 1.407.08 2.697.46 3.728 1.065.4-.468.987-.756 1.617-.756 1.17 0 2.13.953 2.13 2.13 0 .89-.54 1.65-1.33 1.97z"/><circle cx="14.609" cy="13.391" r=".978"/><path d="M17.87 10.956c-.302 0-.583.128-.79.334.616.51 1.082 1.112 1.352 1.774.34-.197.568-.566.568-.978 0-.623-.507-1.13-1.13-1.13z"/></svg>
            </div>Share on Reddit</div>
        </a>

    </div><!-- END MIT LISCENSE MATERIAL-->
    
</body>  
</HTML>
